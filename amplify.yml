version: 1
backend:
  phases:
    build:
      commands:
        - echo "Isshaaann --- start backend build command phases."
        # Install backend dependencies
        - npm ci --cache .npm --prefer-offline
        # Deploy backend using Amplify CLI
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
        - echo "Isshaaann --- end backend build command phases."
    postBuild:
      commands:
        # Optional: Add any post-build steps for the backend
        - echo "Backend build completed."

frontend:
  phases:
    preBuild:
      commands:
        - echo "Isshaaann --- start frontend prebuild command phases."
        # Install frontend dependencies
        - npm ci --cache .npm --prefer-offline
        - echo "Isshaaann --- end frontend prebuild command phases."
    build:
      commands:
        - echo "Isshaaann --- start frontend build command phases."
        # Build the frontend
        - npm run build
        - echo "Isshaaann --- end frontend build command phases."
    postBuild:
      commands:
        - echo "Isshaaann --- start frontend postbuild command phases."
        # Deploy to S3 or other services
        - ./scripts/deploy.sh
        - echo "Isshaaann --- end frontend postbuild command phases."
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - .npm/**/*
      - node_modules/**/*

rollback:
  phases:
    commands:
      - echo "Isshaaann --- start rollback command phases."
      # Rollback to the previous version
      - ./scripts/rollback.sh
      - echo "Isshaaann --- end rollback command phases."
